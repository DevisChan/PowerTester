// Generated by CoffeeScript 1.7.1
(function() {
  var myUI;

  myUI = (function() {
    function myUI(db) {
      var height;
      this.db = db;
      this.mainPanel = document.getElementById('main-panel');
      height = window.innerHeight;
      this.questionField = document.getElementById('question-field');
      $("#commitItem").click((function(_this) {
        return function() {
          var itemContent, itemName;
          itemName = $("#itemName").val();
          itemContent = $("#itemContent").val();
          if (_this.db.addItem(itemName, itemContent)) {
            $("#itemName").val('');
            $("#itemContent").val('');
            return alert('提交成功');
          }
        };
      })(this));
      this.createButton();
      this.init('语文');
      this.showSubject();
      this.con = new Connection('http://172.246.147.104:5000', this.db);
      $("#importWeb").click((function(_this) {
        return function() {
          var func;
          func = function(list) {
            var a, field, l, _i, _len;
            for (_i = 0, _len = list.length; _i < _len; _i++) {
              l = list[_i];
              a = document.createElement('a');
              a.setAttribute('class', 'button btn-subject');
              a.setAttribute('data', l);
              a.innerHTML = l;
              field = document.getElementById("subject-field");
              field.appendChild(a);
            }
            return $(".btn-subject").click(function(event) {
              var name, target;
              target = event.target;
              name = $(target).attr('data');
              return _this.con.importFromServer(name);
            });
          };
          return _this.con.showSubject(func);
        };
      })(this));
    }

    myUI.prototype.showSubject = function() {
      var show;
      this.frame = document.getElementById('subject_choice');
      show = (function(_this) {
        return function(r) {
          var a, i, li, _i, _len, _results;
          _results = [];
          for (_i = 0, _len = r.length; _i < _len; _i++) {
            i = r[_i];
            a = document.createElement('a');
            a.innerHTML = i['name'];
            li = document.createElement('li');
            li.appendChild(a);
            a.setAttribute('href', '#main');
            a.setAttribute('class', 'pressed');
            _this.frame.appendChild(li);
            _results.push($(a).click(function(event) {
              return _this.init(event.target.innerHTML);
            }));
          }
          return _results;
        };
      })(this);
      return this.db.showAllSubject(show);
    };

    myUI.prototype.init = function(subject_name) {
      var createNode;
      createNode = (function(_this) {
        return function(obj) {
          var at, attr, attrs, c, content, _i, _len;
          content = obj['content'];
          attrs = content.match(/\{.*?}/g);
          if (attrs) {
            for (_i = 0, _len = attrs.length; _i < _len; _i++) {
              attr = attrs[_i];
              at = attr.replace('{', '');
              at = at.replace('}', '');
              c = "<span class='mask'>" + at + "</span>";
              content = content.replace(attr, c);
            }
          }
          $(_this.questionField).html("<span class='item'>" + content + "</span>");
          return $(".mask").bind('hover', function(event) {
            var target;
            target = event.target;
            return $(target).css('background-color', 'transparent');
          }, function(event) {
            var target;
            target = event.target;
            return $(target).css('background-color', 'black');
          });
        };
      })(this);
      this.db.showRandomItemFromName(subject_name, createNode);
      return $(".next").click((function(_this) {
        return function() {
          return _this.db.showRandomItemFromName(subject_name, createNode);
        };
      })(this));
    };

    myUI.prototype.createButton = function() {
      var anser, buttonField, next;
      anser = document.createElement('a');
      next = document.createElement('a');
      $(anser).attr('class', 'button icon pencil');
      $(next).attr('class', 'button next');
      anser.innerHTML = 'Anser';
      next.innerHTML = 'Next';
      buttonField = document.createElement('div');
      buttonField.appendChild(anser);
      buttonField.appendChild(next);
      $(buttonField).attr('class', 'button-field');
      $(anser).click(function() {
        $(".mask").css('background-color', 'transparent');
        return $(".mask").css('color', 'red');
      });
      return this.mainPanel.appendChild(buttonField);
    };

    return myUI;

  })();

  this.ui = new myUI(this.db);

}).call(this);
